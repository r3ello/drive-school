<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Scheduling Calendar</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <div class="sidebar-brand-mark">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                    </div>
                    <div>
                        <h1>Calendar</h1>
                        <p>Class Scheduling</p>
                    </div>
                </div>
                <button class="sidebar-close-btn" id="sidebarCloseBtn" title="Close sidebar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <nav class="sidebar-nav">
                <span class="nav-section-label">Navigation</span>
                <button class="nav-btn active" data-view="calendar">
                    <span class="nav-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                    </span>
                    <span>Calendar</span>
                </button>
                <button class="nav-btn" data-view="students" data-teacher-only>
                    <span class="nav-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                    </span>
                    <span>Students</span>
                </button>
                <button class="nav-btn" data-view="waitlist" data-teacher-only>
                    <span class="nav-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="8" y1="6" x2="21" y2="6"/>
                            <line x1="8" y1="12" x2="21" y2="12"/>
                            <line x1="8" y1="18" x2="21" y2="18"/>
                            <line x1="3" y1="6" x2="3.01" y2="6"/>
                            <line x1="3" y1="12" x2="3.01" y2="12"/>
                            <line x1="3" y1="18" x2="3.01" y2="18"/>
                        </svg>
                    </span>
                    <span>Waitlist</span>
                </button>
                <button class="nav-btn" data-view="blocks" data-teacher-only>
                    <span class="nav-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                        </svg>
                    </span>
                    <span>Blocked Times</span>
                </button>
            </nav>
            <div class="sidebar-footer">
                <button class="btn btn-primary btn-block" id="quickAddSlot" data-teacher-only>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Quick Add Slot
                </button>
            </div>
        </aside>

        <!-- Sidebar overlay for mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Top bar -->
            <div class="topbar">
                <button class="sidebar-toggle" id="sidebarToggle" title="Toggle sidebar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
                <h2 class="topbar-title" id="topbarTitle">Calendar</h2>
                <div id="sseStatusDot" class="sse-dot sse-dot--disconnected" title="Live updates: connecting…"></div>
                <div class="topbar-user">
                    <span id="userDisplayName" class="topbar-user-name"></span>
                    <button class="btn btn-sm btn-secondary" id="logoutBtn">Logout</button>
                </div>
            </div>

            <!-- Calendar View -->
            <section id="calendarView" class="view active">
                <div class="view-header">
                    <div class="view-mode-switcher">
                        <button class="view-mode-btn" data-mode="day">Day</button>
                        <button class="view-mode-btn active" data-mode="week">Week</button>
                        <button class="view-mode-btn" data-mode="month">Month</button>
                    </div>
                    <div class="view-actions">
                        <button class="btn btn-secondary btn-icon" id="prevPeriod" title="Previous">
                            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                        </button>
                        <button class="btn btn-today" id="todayBtn">Today</button>
                        <button class="btn btn-secondary btn-icon" id="nextPeriod" title="Next">
                            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                        </button>
                        <span id="currentPeriodLabel" class="period-label">Loading…</span>
                        <button class="btn btn-primary" id="generateSlotsBtn" data-teacher-only>
                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                            </svg>
                            Generate
                        </button>
                    </div>
                </div>
                <div class="calendar-container">
                    <!-- Week/Day view -->
                    <div class="calendar-grid" id="calendarGrid"></div>
                    <!-- Month view -->
                    <div class="month-grid" id="monthGrid" style="display:none;"></div>
                </div>
            </section>

            <!-- Students View -->
            <section id="studentsView" class="view">
                <div class="view-header">
                    <div class="view-actions" style="width:100%;">
                        <input type="text" id="studentSearch" placeholder="Search students…" class="search-input">
                        <select id="studentActiveFilter" class="filter-select">
                            <option value="">All</option>
                            <option value="true" selected>Active</option>
                            <option value="false">Inactive</option>
                        </select>
                        <button class="btn btn-primary" id="addStudentBtn">
                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Add Student
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table" id="studentsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Notifications</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody"></tbody>
                    </table>
                </div>
                <div class="pagination" id="studentsPagination"></div>
            </section>

            <!-- Waitlist View -->
            <section id="waitlistView" class="view">
                <div class="view-header">
                    <div class="view-actions">
                        <select id="waitlistActiveFilter" class="filter-select">
                            <option value="true" selected>Active</option>
                            <option value="false">Inactive</option>
                        </select>
                        <button class="btn btn-primary" id="addWaitlistBtn">
                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Add to Waitlist
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table" id="waitlistTable">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Preferred Days</th>
                                <th>Preferred Times</th>
                                <th>Priority</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="waitlistTableBody"></tbody>
                    </table>
                </div>
                <div class="pagination" id="waitlistPagination"></div>
            </section>

            <!-- Blocks View -->
            <section id="blocksView" class="view">
                <div class="view-header">
                    <div class="view-actions">
                        <button class="btn btn-primary" id="addBlockBtn">
                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Add Block
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table" id="blocksTable">
                        <thead>
                            <tr>
                                <th>From</th>
                                <th>To</th>
                                <th>Reason</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="blocksTableBody"></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Container -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Modal Title</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts — load order matters: auth.js first -->
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/students.js"></script>
    <script src="js/waitlist.js"></script>
    <script src="js/blocks.js"></script>
    <script src="js/sse.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
